@extends('layouts.admin')

@section('content')
<div class="admin-content">
    <div class="dashboard-header">
        <h1>ğŸ“Š Panel Administrativo</h1>
        <p>Bienvenido al panel de administraciÃ³n del ISTS</p>
    </div>

    <!-- EstadÃ­sticas (recuperadas de la versiÃ³n previa) -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">ğŸ“</div>
            <div class="stat-content">
                <h3>{{ $stats['total_contents'] ?? 0 }}</h3>
                <p>Contenidos Totales</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">ğŸ“°</div>
            <div class="stat-content">
                <h3>{{ $stats['total_news'] ?? 0 }}</h3>
                <p>Noticias Totales</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-content">
                <h3>{{ $stats['total_users'] ?? 0 }}</h3>
                <p>Usuarios Registrados</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">ğŸ‘ï¸</div>
            <div class="stat-content">
                <h3>{{ $stats['total_views'] ?? 0 }}</h3>
                <p>Vistas Totales</p>
            </div>
        </div>
    </div>

    <!-- GestiÃ³n de Contenido - Cajas Cuadradas -->
        <div class="quick-actions">
            <h2>â• GESTIÃ“N DE CONTENIDO</h2>
            <div class="actions-grid">
                @php
                    $careers = \App\Models\Career::orderBy('sort_order')->get();
                    $sections = \App\Models\AcademicSection::orderBy('sort_order')->get();
                    // La tabla `campus_items` utiliza la columna `order` (no `sort_order`)
                    $campusItems = \App\Models\CampusItem::orderBy('order')->get();
                    $leaders = \App\Models\LeadershipTeam::orderBy('order')->get();
                    $teachers = \App\Models\Teacher::orderBy('name')->get();
                    // En la tabla `hero_slides` la columna de orden se llama `sort_order`
                    $slides = \App\Models\HeroSlide::orderBy('sort_order')->get();
                    $contents = \DB::table('contents')->orderBy('created_at','desc')->limit(10)->get();
                    $totalContents = \DB::table('contents')->count();
                    
                    // Contenidos especÃ­ficos de la secciÃ³n "Acerca"
                    $historiaContent = \DB::table('contents')->where('slug', 'linea-de-tiempo')->first();
                    $misionVisionContent = \DB::table('contents')->where('slug', 'mision-y-vision')->first();
                    $organigramaContent = \DB::table('contents')->where('slug', 'organigrama')->first();
                @endphp

                <a href="{{ route('admin.careers.index') }}" class="action-card">
                    <div class="action-icon">ğŸ“</div>
                    <h3>Programas de Grado</h3>
                    <p>{{ $careers->count() }} carreras registradas</p>
                </a>

                <a href="{{ route('admin.academic-sections.index') }}" class="action-card">
                    <div class="action-icon">ğŸ“š</div>
                    <h3>EducaciÃ³n Continua</h3>
                    <p>{{ $sections->count() }} secciones activas</p>
                </a>

                <a href="{{ route('admin.campus-items.index') }}" class="action-card">
                    <div class="action-icon">ğŸ›ï¸</div>
                    <h3>Servicios del Campus</h3>
                    <p>{{ $campusItems->count() }} servicios disponibles</p>
                </a>

                <a href="{{ route('admin.hero-slides.index') }}" class="action-card">
                    <div class="action-icon">ğŸ–¼ï¸</div>
                    <h3>Hero Slides</h3>
                    <p>{{ $slides->count() }} slides en carrusel</p>
                </a>

                <a href="{{ route('admin.news.index') }}" class="action-card">
                    <div class="action-icon">ğŸ“°</div>
                    <h3>Noticias</h3>
                    <p>{{ \App\Models\News::count() }} noticias publicadas</p>
                </a>

                <a href="{{ route('admin.leadership.index') }}" class="action-card">
                    <div class="action-icon">ğŸ‘¨â€ğŸ«</div>
                    <h3>Autoridades</h3>
                    <p>{{ $leaders->count() }} miembros registrados</p>
                </a>

                <a href="{{ route('admin.teachers.index') }}" class="action-card">
                    <div class="action-icon">ğŸ‘©â€ğŸ«</div>
                    <h3>Planta Docente</h3>
                    <p>{{ $teachers->count() }} docentes registrados</p>
                </a>

                @if($historiaContent)
                    <a href="{{ route('admin.contents.edit', $historiaContent->id) }}" class="action-card">
                        <div class="action-icon">ğŸ“œ</div>
                        <h3>Historia</h3>
                        <p>LÃ­nea de tiempo institucional</p>
                    </a>
                @else
                    <a href="{{ route('admin.contents.create') }}?slug=linea-de-tiempo" class="action-card" style="opacity: 0.7;">
                        <div class="action-icon">ğŸ“œ</div>
                        <h3>Historia</h3>
                        <p>âš ï¸ No creado - Crear ahora</p>
                    </a>
                @endif

                @if($misionVisionContent)
                    <a href="{{ route('admin.contents.edit', $misionVisionContent->id) }}" class="action-card">
                        <div class="action-icon">ğŸ¯</div>
                        <h3>MisiÃ³n y VisiÃ³n</h3>
                        <p>PropÃ³sito institucional</p>
                    </a>
                @else
                    <a href="{{ route('admin.contents.create') }}?slug=mision-y-vision" class="action-card" style="opacity: 0.7;">
                        <div class="action-icon">ğŸ¯</div>
                        <h3>MisiÃ³n y VisiÃ³n</h3>
                        <p>âš ï¸ No creado - Crear ahora</p>
                    </a>
                @endif

                @if($organigramaContent)
                    <a href="{{ route('admin.contents.edit', $organigramaContent->id) }}" class="action-card">
                        <div class="action-icon">ğŸ¢</div>
                        <h3>Organigrama</h3>
                        <p>Estructura organizacional</p>
                    </a>
                @else
                    <a href="{{ route('admin.contents.create') }}?slug=organigrama" class="action-card" style="opacity: 0.7;">
                        <div class="action-icon">ğŸ¢</div>
                        <h3>Organigrama</h3>
                        <p>âš ï¸ No creado - Crear ahora</p>
                    </a>
                @endif

                                <a href="{{ route('admin.contents.index') }}" class="action-card">
                    <div class="action-icon">ğŸ“</div>
                    <h3>Todos los Contenidos</h3>
                    <p>{{ $totalContents }} artÃ­culos totales</p>
                </a>
            </div>
        </div>

    <!-- Acciones RÃ¡pidas -->
    <div class="quick-actions">
        <h2>ğŸ“– SECCIÃ“N ACERCA</h2>
        <div class="actions-grid">
            <a href="{{ route('admin.leadership.index') }}" class="action-card">
                <div class="action-icon">ğŸ‘¨â€ğŸ«</div>
                <h3>Autoridades</h3>
                <p>{{ $leaders->count() }} miembros registrados</p>
            </a>

            <a href="{{ route('admin.teachers.index') }}" class="action-card">
                <div class="action-icon">ğŸ‘©â€ğŸ«</div>
                <h3>Planta Docente</h3>
                <p>{{ $teachers->count() }} docentes registrados</p>
            </a>

            @if($historiaContent)
                <a href="{{ route('admin.contents.edit', $historiaContent->id) }}" class="action-card">
                    <div class="action-icon">ï¿½</div>
                    <h3>Historia</h3>
                    <p>LÃ­nea de tiempo institucional</p>
                </a>
            @else
                <a href="{{ route('admin.contents.create') }}?slug=linea-de-tiempo" class="action-card" style="opacity: 0.7;">
                    <div class="action-icon">ğŸ“œ</div>
                    <h3>Historia</h3>
                    <p>âš ï¸ No creado - Crear ahora</p>
                </a>
            @endif

            @if($misionVisionContent)
                <a href="{{ route('admin.contents.edit', $misionVisionContent->id) }}" class="action-card">
                    <div class="action-icon">ğŸ¯</div>
                    <h3>MisiÃ³n y VisiÃ³n</h3>
                    <p>PropÃ³sito institucional</p>
                </a>
            @else
                <a href="{{ route('admin.contents.create') }}?slug=mision-y-vision" class="action-card" style="opacity: 0.7;">
                    <div class="action-icon">ğŸ¯</div>
                    <h3>MisiÃ³n y VisiÃ³n</h3>
                    <p>âš ï¸ No creado - Crear ahora</p>
                </a>
            @endif

            @if($organigramaContent)
                <a href="{{ route('admin.contents.edit', $organigramaContent->id) }}" class="action-card">
                    <div class="action-icon">ğŸ¢</div>
                    <h3>Organigrama</h3>
                    <p>Estructura organizacional</p>
                </a>
            @else
                <a href="{{ route('admin.contents.create') }}?slug=organigrama" class="action-card" style="opacity: 0.7;">
                    <div class="action-icon">ğŸ¢</div>
                    <h3>Organigrama</h3>
                    <p>âš ï¸ No creado - Crear ahora</p>
                </a>
            @endif
        </div>
    </div>
    <div class="quick-actions">
        <h2>ğŸš€ Acciones RÃ¡pidas</h2>
        <div class="actions-grid">
            <a href="{{ route('admin.contents.create') }}" class="action-card">
                <div class="action-icon">ğŸ“</div>
                <h3>Crear Contenido</h3>
                <p>Agregar nuevo contenido al sitio</p>
            </a>

            <a href="{{ route('admin.news.create') }}" class="action-card">
                <div class="action-icon">ğŸ“°</div>
                <h3>Crear Noticia</h3>
                <p>Publicar nueva noticia</p>
            </a>

            <a href="{{ route('admin.leadership.index') }}" class="action-card">
                <div class="action-icon">ğŸ‘¨â€ğŸ«</div>
                <h3>Gestionar Equipo</h3>
                <p>Administrar el equipo directivo</p>
            </a>

            <a href="{{ route('admin.users.index') }}" class="action-card">
                <div class="action-icon">ğŸ‘¥</div>
                <h3>Gestionar Usuarios</h3>
                <p>Administrar usuarios del sistema</p>
            </a>

            <a href="#" class="action-card">
                <div class="action-icon">âš™ï¸</div>
                <h3>ConfiguraciÃ³n</h3>
                <p>Ajustar configuraciÃ³n del sistema</p>
            </a>
        </div>
    </div>
    <div class="recent-content">
        <div class="recent-section">
            <h2>ğŸ“ Contenidos Recientes</h2>
            <div class="content-list">
                @if(!empty($stats['recent_contents']))
                    @foreach($stats['recent_contents'] as $content)
                        <div class="content-item">
                            <div class="content-info">
                                <h4>{{ $content['title'] }}</h4>
                                <p>{{ Illuminate\Support\Str::limit($content['description'] ?? '', 100) }}...</p>
                                <span class="content-meta">
                                    {{ optional(\Carbon\Carbon::parse($content['created_at'] ?? null))->format('d/m/Y') }} â€¢ {{ ucfirst($content['status'] ?? '') }}
                                </span>
                            </div>
                            <div class="content-actions">
                                <a href="{{ route('admin.contents.edit', $content['id']) }}" class="btn btn-sm">âœï¸ Editar</a>
                                <form action="{{ route('admin.contents.destroy', $content['id']) }}" method="POST" style="display:inline;" onsubmit="return confirm('Â¿Eliminar este contenido?')">
                                    @csrf
                                    @method('DELETE')
                                    <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ï¸ Eliminar</button>
                                </form>
                            </div>
                        </div>
                    @endforeach
                @else
                    <p class="no-content">No hay contenidos recientes</p>
                @endif
            </div>
        </div>

        <div class="recent-section">
            <h2>ğŸ“° Noticias Recientes</h2>
            <div class="content-list">
                @if(!empty($stats['recent_news']))
                    @foreach($stats['recent_news'] as $news)
                        <div class="content-item">
                            <div class="content-info">
                                <h4>{{ $news['title'] }}</h4>
                                <p>{{ Illuminate\Support\Str::limit($news['summary'] ?? '', 100) }}...</p>
                                <span class="content-meta">
                                    {{ optional(\Carbon\Carbon::parse($news['published_at'] ?? null))->format('d/m/Y') }}
                                </span>
                            </div>
                            <div class="content-actions">
                                <a href="{{ route('admin.news.edit', $news['id']) }}" class="btn btn-sm">âœï¸ Editar</a>
                                <form action="{{ route('admin.news.destroy', $news['id']) }}" method="POST" style="display:inline;" onsubmit="return confirm('Â¿Eliminar esta noticia?')">
                                    @csrf
                                    @method('DELETE')
                                    <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ï¸ Eliminar</button>
                                </form>
                            </div>
                        </div>
                    @endforeach
                @else
                    <p class="no-content">No hay noticias recientes</p>
                @endif
            </div>
        </div>
    </div>
</div>
@endsection
